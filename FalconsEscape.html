<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Falcon's Escape - Star Wars Arena Shooter</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="FalconsEscape.css" />
    <!-- Add module support check -->
    <script>
      // Check for module support
      const supportsModules = 'noModule' in HTMLScriptElement.prototype;
      if (!supportsModules) {
        // Load SystemJS for browsers that don't support modules
        document.write('<script src="https://unpkg.com/systemjs@6.12.1/dist/system.js"><\/script>');
        document.write('<script>System.import("/js/index.js");<\/script>');
      }
    </script>
  </head>
  <body>
    <!-- SVG Sprites -->
    <svg class="hidden">
      <defs>
        <!-- Millennium Falcon -->
        <g id="falcon">
          <ellipse cx="0" cy="0" rx="25" ry="15" fill="#cccccc" stroke="#888888" stroke-width="2" />
          <ellipse cx="-10" cy="0" rx="8" ry="12" fill="#aaaaaa" />
          <ellipse cx="10" cy="0" rx="8" ry="12" fill="#aaaaaa" />
          <circle cx="-5" cy="-8" r="3" fill="#0088ff" />
          <circle cx="5" cy="-8" r="3" fill="#0088ff" />
          <rect x="-2" y="15" width="4" height="8" fill="#ff6600" />
          <rect x="-8" y="12" width="4" height="6" fill="#ff6600" />
          <rect x="4" y="12" width="4" height="6" fill="#ff6600" />
        </g>

        <!-- TIE Fighter -->
        <g id="tie">
          <circle cx="0" cy="0" r="8" fill="#333333" stroke="#666666" stroke-width="1" />
          <rect x="-15" y="-5" width="30" height="10" fill="#444444" />
          <rect x="-12" y="-3" width="24" height="6" fill="#666666" />
          <circle cx="0" cy="0" r="4" fill="#ff0000" />
        </g>
        <!-- heavy Fighter -->
        <g id="heavy">
          <path d="M -15,-5 L 15,-5 L 15,5 L -15,5 Z" fill="#333333" stroke="#666666" stroke-width="1" />
          <path d="M -12,-3 L 12,-3 L 12,3 L -12,3 Z" fill="#444444" stroke="#666666" stroke-width="1" />
          <path d="M -6,-2 L 6,-2 L 6,2 L -6,2 Z" fill="#666666" stroke="#666666" stroke-width="1" />
          <path d="M 0,-4 L 0,4 M -4,0 L 4,0" stroke="#ff0000" stroke-width="2" stroke-linecap="round" />
        </g>
        <!-- interceptor Fighter -->
        <g id="interceptor">
          <circle cx="0" cy="0" r="8" fill="#000" stroke="#000" stroke-width="2" />
          <path d="M -6,0 L 6,0 M 0,-6 L 0,6" stroke="#ff0000" stroke-width="2" stroke-linecap="round" />
          <path d="M -4,-4 L 4,4 M -4,4 L 4,-4" stroke="#ff0000" stroke-width="2" stroke-linecap="round" />
        </g>

        <!-- Boss Ship -->
        <g id="boss">
          <ellipse cx="0" cy="0" rx="40" ry="20" fill="#444444" stroke="#666666" stroke-width="3" />
          <ellipse cx="0" cy="0" rx="30" ry="15" fill="#666666" />
          <rect x="-35" y="-8" width="70" height="16" fill="#333333" />
          <circle cx="-20" cy="0" r="6" fill="#ff0000" />
          <circle cx="0" cy="0" r="6" fill="#ff0000" />
          <circle cx="20" cy="0" r="6" fill="#ff0000" />
          <rect x="-5" y="20" width="10" height="15" fill="#ff6600" />
        </g>

        <!-- Laser Bolt -->
        <g id="laser">
          <rect x="-1" y="-8" width="2" height="16" fill="#00ff00" />
          <rect x="-2" y="-6" width="4" height="12" fill="#88ff88" opacity="0.5" />
        </g>

        <!-- Enemy Laser -->
        <g id="enemyLaser">
          <rect x="-1" y="-8" width="2" height="16" fill="#ff0000" />
          <rect x="-2" y="-6" width="4" height="12" fill="#ff8888" opacity="0.5" />
        </g>

        <!-- Power-up -->
        <g id="powerup">
          <rect x="-8" y="-8" width="16" height="16" fill="#0088ff" stroke="#00ccff" stroke-width="2" />
          <rect x="-6" y="-6" width="12" height="12" fill="#00ccff" opacity="0.7" />
          <text x="0" y="4" text-anchor="middle" fill="white" font-size="12">+</text>
        </g>
      </defs>
    </svg>

    <!-- Game Canvas -->
    <canvas id="gameCanvas"></canvas>

    <!-- HUD -->
    <div id="hud">
      <div id="healthBar">
        <div id="healthFill"></div>
      </div>
      <div class="text-white text-lg">
        Punkty:
        <span id="score">0</span>
        | Poziom:
        <span id="level">1</span>
      </div>
    </div>

    <!-- Joystick -->
    <div id="joystick">
      <div id="joystickKnob"></div>
    </div>

    <!-- Pause Button -->
    <button id="pauseBtn" class="fixed top-4 right-4 bg-black bg-opacity-50 text-white p-2 rounded-lg z-10">
      <i class="fas fa-pause"></i>
    </button>

    <!-- Pause Overlay -->
    <div id="pauseOverlay" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-20">
      <div class="text-center">
        <h2 class="text-4xl mb-6 text-white font-bold">PAUZA</h2>
        <button id="resumeBtn" class="menu-button">
          <i class="fas fa-play mr-2"></i>
          WZNÓW GRĘ
        </button>
      </div>
    </div>

    <!-- Main Menu -->
    <div id="menu">
      <h1 class="text-6xl mb-8 text-blue-400 font-bold" style="display: none">FALCON'S ESCAPE</h1>
      <!-- Grafika Millennium Falcona -->
      <img src="falcon-logo.png" alt="Millennium Falcon" class="mx-auto mb-8" width="350" height="350" />
      <p class="text-xl mb-8 text-center max-w-md">Steruj Millennium Falconem i uciekaj przed flotą Imperium!</p>
      <button id="startBtn" class="menu-button">
        <i class="fas fa-play mr-2"></i>
        START GRY
      </button>
      <button id="instructionsBtn" class="menu-button">
        <i class="fas fa-info-circle mr-2"></i>
        INSTRUKCJE
      </button>
    </div>

    <!-- Instructions Screen -->
    <div id="instructionsScreen" class="hidden">
      <h2 class="text-4xl mb-6 text-blue-300 font-bold">
        <i class="fas fa-info-circle mr-2"></i>
        INSTRUKCJE
      </h2>
      <div class="text-lg max-w-xl mb-8 text-center">
        <p>Steruj Millennium Falconem, unikaj wrogów i zbieraj power-upy!</p>
        <ul class="list-disc list-inside text-left mt-4 mb-4">
          <li>Poruszaj się joystickiem (lewy dolny róg) lub klawiszami WSAD/strzałkami.</li>
          <li>Automatycznie strzelasz do najbliższego wroga.</li>
          <li>Zbieraj niebieskie power-upy, aby odzyskać zdrowie.</li>
          <li>Pokonuj kolejne fale wrogów i bossów, aby przejść do następnego poziomu.</li>
          <li>Unikaj laserów przeciwników i nie pozwól, by pasek zdrowia spadł do zera!</li>
        </ul>
        <p>Powodzenia, niech Moc będzie z Tobą!</p>
      </div>
      <button id="backToMenuBtn" class="menu-button">
        <i class="fas fa-arrow-left mr-2"></i>
        WRÓĆ DO MENU
      </button>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="hidden">
      <h2 class="text-4xl mb-4 text-red-400">MISJA ZAKOŃCZONA</h2>
      <p class="text-xl mb-4">
        Twój wynik:
        <span id="finalScore">0</span>
      </p>
      <p class="text-xl mb-8">
        Osiągnięty poziom:
        <span id="finalLevel">1</span>
      </p>
      <button id="restartBtn" class="menu-button">
        <i class="fas fa-redo mr-2"></i>
        ZAGRAJ PONOWNIE
      </button>
      <button id="menuBtn" class="menu-button">
        <i class="fas fa-home mr-2"></i>
        MENU GŁÓWNE
      </button>
    </div>

    <!-- Level Intro -->
    <div id="levelIntro" class="hidden">
      <h2 class="text-4xl mb-4 text-yellow-400">
        POZIOM
        <span id="currentLevelText">1</span>
      </h2>
      <p class="text-xl mb-8 text-center max-w-lg" id="levelDescription">
        Flotilla myśliwców TIE nadciąga! Przygotuj się do walki!
      </p>
      <button id="startLevelBtn" class="menu-button">
        <i class="fas fa-rocket mr-2"></i>
        ROZPOCZNIJ POZIOM
      </button>
    </div>

    <!-- Volume Control -->
    <div
      id="volumeControl"
      class="fixed bottom-4 right-4 z-50 cursor-pointer text-white text-2xl bg-black bg-opacity-50 p-2 rounded-full w-10 h-10 flex items-center justify-center">
      <i class="fas fa-volume-up" id="volumeIcon"></i>
    </div>

    <!-- Background Music -->
    <audio id="backgroundMusic" preload="auto">
      <source src="Shadow of the Warrior.mp3" type="audio/mpeg" />
    </audio>

    <!-- Video Overlay -->
    <div id="videoOverlay">
      <button id="skipBtn">
        <i class="fas fa-forward mr-2"></i>
        POMIŃ
      </button>
      <video
        id="cutsceneVideo"
        autoplay
        muted
        controls
        playsinline
        webkit-playsinline
        style="width: 100%; height: 100%; object-fit: cover">
        <!-- Placeholder for cutscene videos -->
        <source src="video/falcon001.mp4" type="video/mp4" />
        <p>Twoja przeglądarka nie obsługuje video HTML5.</p>
      </video>
    </div>

    <script type="module">
      // Import and initialize the game
      import './js/gameLogic.js';
      import './js/enemyTypes.js';
      import './js/levelConfigs.js';
      import './js/gameState.js';
      import './js/background.js';
      import './js/index.js';
    </script>

    <!-- Fallback for browsers without module support -->
    <script nomodule>
      console.warn('Your browser does not support JavaScript modules. Please use a modern browser.');
    </script>
  </body>
</html>
