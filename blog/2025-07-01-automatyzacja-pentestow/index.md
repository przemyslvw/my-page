---
slug: automatyzacja-pentestow
title: "Automatyzacja testów penetracyjnych i monitoringu logów dla aplikacji webowej"
authors: [przemyslvw]
tags: ['pentesting', 'security', 'automation', 'webapp']
date: 2025-07-01
---

Niniejszy raport przedstawia kompletną, zautomatyzowaną architekturę służącą do:

* wykonywania **testów penetracyjnych typu SAST, DAST i IAST**,
* ciągłego **skanowania logów** w celu wczesnego wykrywania ataków i anomalii,
* integracji obu procesów z pipeline’em CI/CD, tak aby bezpieczeństwo aplikacji było kontrolowane przy każdym commicie i wdrożeniu.

Już we wstępie warto podkreślić dwie główne korzyści omawianego rozwiązania: skrócenie czasu wykrycia podatności do minut zamiast tygodni [^1][^2] oraz radykalne ograniczenie kosztów reagowania dzięki automatycznym akcjom typu “block \& alert” [^3].

<!-- truncate -->

## 1. Fundamenty strategii DevSecOps

### 1.1 Model „shift-left”

Przesunięcie testów bezpieczeństwa na wczesne etapy SDLC eliminuje ponad 75% podatności jeszcze przed produkcją [^2]. Kluczowe fazy obejmują:

1. **Kodowanie** – skan zależności i tajnych kluczy (SCA/Secret Detection).
2. **Budowanie** – SAST i skan kontenerów.
3. **Testy QA** – DAST, fuzzing, testy infrastruktury jako kodu.
4. **Eksploatacja** – ciągłe testy regresyjne, korelacja logów, aktywna reakcja.

### 1.2 Ramy referencyjne

Rekomendowany zestaw standardów to: OWASP ASVS do testów aplikacyjnych [^4], MITRE ATT\&CK do modelowania zagrożeń oraz CIS Controls w warstwie logowania [^5].

## 2. Zautomatyzowane testy penetracyjne

### 2.1 Static Application Security Testing (SAST)

* **Semgrep/Gitleaks** – skany regułowe w czasie kompilacji wychwytują błędy kryptografii i wycieki sekretów [^6].
* **OWASP Dependency-Check/Safety** – CVE w bibliotekach blokują build przy CVSS ≥ 7 [^7].


### 2.2 Dynamic Application Security Testing (DAST)

* **OWASP ZAP AF** – plik YAML opisuje pełny crawl i aktywny skan; można go uruchomić w kontenerze “zap2docker-stable” z poziomu GitHub Actions [^8][^9].
* **Nuclei** – ultraszybki skaner szablonów YAML; w pipeline CI można wymusić zatrzymanie wdrożenia przy trafieniu krytycznym [^10][^11].
* **Burp Suite CLI** – dla testów logiki biznesowej; rozszerzenia BCheck/Burp Bounty automatyzują testy pasywne i aktywne [^12].


### 2.3 Interaktywne testy (IAST)

Dodatkowa warstwa agentów (np. Contrast IAST) podłącza się w czasie testów E2E i oznacza luki, których nie wychwytuje sam DAST.

### 2.4 Testy infrastruktury i kontenerów

* **Trivy/Clair** – analiza obrazów Docker, K8s manifests, Helm Charts [^7].
* **tfsec/Checkov** – scanning Terraform, CloudFormation, Pulumi pod kątem błędów konfiguracji [^13].


### 2.5 Orkiestracja pipeline

Przykładowy plik `.gitlab-ci.yml` lub GitHub Workflow powinien zawierać etapy `sast`, `sca`, `container-scan`, `dast` i `iac-scan`, z zasadą **fail-fast** dla poziomów wysokich i krytycznych [^7][^14].

## 3. Automatyczne skanowanie i korelacja logów

### 3.1 Wymagania regulacyjne

Logi muszą zapewniać nienaruszalność (WORM), sygnaturę czasu i możliwość korelacji z danymi z testów [^15].

### 3.2 Architektura ELK + Wazuh

Połączenie Filebeat → Logstash → Elasticsearch zapewnia skalowalny transport i parsowanie logów (Grok, dissect) [^16][^17]. Nad nim warstwa **Wazuh** pełni funkcję HIDS, FIM, SIEM i modułu Active Response [^18][^3].

Przepływ:

1. **Agenci** Filebeat wysyłają JSON z aplikacji oraz system-audit.
2. **Logstash** wzbogaca zdarzenia o GeoIP, identyfikatory CVE i tagi środowiskowe [^17][^19].
3. **Elasticsearch** utrzymuje indeksy `security-logs-*` z retencją 90 dni [^16].
4. **Wazuh Manager** analizuje strumień zdarzeń w czasie rzeczywistym, łącząc je z własnymi regułami (np. brute-force, SQLi, LFI) [^20].
5. **Active Response** wyzwala akcje takie jak `host-deny` lub `firewall-drop` dla IP o wysokiej reputacji ryzyka [^3].

![Architectural diagram showing Wazuh agents collecting and feeding data into a Wazuh server cluster.](https://pplx-res.cloudinary.com/image/upload/v1748609227/pplx_project_search_images/45dc90e114220b79ca4b4a8845d2d1a09e8b61c5.jpg)

Architectural diagram showing Wazuh agents collecting and feeding data into a Wazuh server cluster.

### 3.3 Alerting i SOAR light

Rule-Engine Wazuh przypisuje poziomy 0-15; dla poziomu ≥ 7 wysyłamy powiadomienia do SIEM/Slack/Jira oraz uruchamiamy playbook SOAR (np. izolacja hosta) [^21][^3].

### 3.4 Wykrywanie anomalii AI/ML

Przy wolumenie > 100 GB logów / dobę klasyczne reguły nie wystarczą. Integracja z modułem **Loglizer** lub ML job Elastic (Machine Learning jobs) umożliwia detekcję odchyleń bez etykiet [^22][^23][^24].

### 3.5 Przykładowe reguły bezpieczeństwa

| Cel | Wzorzec Grok/Regex | Próg | Akcja |
| :-- | :-- | :-- | :-- |
| Atak brute force | `Failed password|authentication failure` | 5 × w 5 min | blokada IP 1 h |
| Próba SQLi | `(?i)(union.*select|drop table)` | 1 | izolacja kontenera |
| XSS | `(?i)(<script|javascript:|onerror=)` | 1 | alert wysoki |
| Escalacja sudo | `sudo:.*COMMAND=.*` | 3 × w 10 min | eskalacja do SOC |

## 4. Integracja testów i monitoringu

### 4.1 Korelacja wyników DAST z logami

* Identyfikator skanu (scan-id) trafia jako nagłówek HTTP; Logstash zapisuje go w polu `zap_scan_id`.
* Jeśli Wazuh wykryje exploit zbieżny z aktywnym testem, incydent oznaczany jest statusem `benign_test`- w ten sposób unikamy false-positive [^8][^21].


### 4.2 Harmonogram regresji

Cron pipeline uruchamia pełny skan ZAP + Nuclei na środowisku staging co noc; wyniki porównywane są z poprzednim raportem w bazie PostgreSQL. Wykrycie nowej luki generuje ticket Jira automatycznie [^11][^14].

### 4.3 Metryki i raportowanie

* **Coverage** – procent endpointów odwiedzonych przez crawler ZAP > 85% [^25].
* **MTTD/MTTR** – śr. czas wykrycia < 5 min, czas neutralizacji < 15 min dzięki Active Response [^26][^3].
* **False Positive Rate** – < 2% po kalibracji reguł Grok i AI [^22].


## 5. Wdrożenie krok-po-kroku

1. **Sieć bezpieczeństwa** – utwórz osobną podsieć Docker/K8s (np. `zapnet`) dla skanerów, aby nie blokowały ruchu produkcyjnego [^9].
2. **Instalacja Wazuh** – skrypt `install_wazuh.sh` z repo oficjalnego; konfiguracja klastra 1 × Master + 2 × Worker dla HA [^18].
3. **Filebeat na hostach** – moduły `system`, `nginx`, `mysql`, `auditd`; transport TLS na port 5044 [^27].
4. **Szablony Nuclei** – aktualizowane codziennie przez `nuclei -update-templates` [^10].
5. **ZAP baseline** w pipeline PR; pełny skan tylko na branch `main`.
6. **Reguły Wazuh** – import pliku `custom_rules.xml`, w tym reguł z pkt 3.5 [^20].
7. **Akcje Active Response** – skrypt `iptables_drop.sh` oraz `aws_cli isolate-instance` dla workloadów w chmurze [^3].

## 6. Najczęstsze pułapki i jak ich uniknąć

| Problem | Przyczyna | Remedium |
| :-- | :-- | :-- |
| Fala fałszywych alertów po uruchomieniu skanerów | Brak whitelistingu adresów testowych | Wprowadź tag `scanner_ip` i filtruj w regułach Wazuh [^3] |
| “x509: cannot validate certificate” w Filebeat | Certyfikat bez SAN IP | Wygeneruj cert z `subjectAltName=IP` lub użyj FQDN [^27] |
| Utrata spójności indeksów ES | Niestandardowe pola bez template’u | Użyj template dynamic `security-logs-*` oraz ILM policies [^16] |
| Skan DAST blokuje sesje użytkowników | Zbyt agresywna polityka “Active Scan” | Skonfiguruj limit `maxRuleDurationInMins` i włącz tryb time-boxed [^8] |

## 7. Rozszerzenia i skalowanie

* **Serverless DAST** – uruchamianie ZAP w AWS Fargate na żądanie, koszty tylko za czas skanu.
* **Grafana/Loki** zamiast pełnego ELK dla środowisk o mniejszym wolumenie logów [^28].
* **SOAR pełny** – integracja z TheHive/Cortex lub StackStorm w celu automatycznej triage i eskalacji incydentów.


## 8. Podsumowanie

Zaproponowany stos narzędzi **ZAP + Nuclei + ELK + Wazuh** pozwala zbudować w pełni zautomatyzowany ekosystem DevSecOps:

* **Szybkość** – każdy commit przechodzi testy bezpieczeństwa w ciągu minut, a incydenty produkcyjne są blokowane w czasie rzeczywistym.
* **Skalowalność** – architektura klastrowa Wazuh i indeksy rozproszone ES obsługują tysiące EPS [^18][^16].
* **Kompletność** – łączy analizę kodu, aplikacji, infrastruktury i logów w jednym przepływie, minimalizując luki pokrycia [^29][^30][^31].
* **Oszczędność** – rozwiązanie open-source redukuje koszty licencji, a automatyzacja ogranicza wydatki na ręczne testy i SOC [^22][^13].

Wdrożenie opisanych komponentów zapewni Twojej aplikacji webowej ciągłą, wielowarstwową ochronę zgodną z najlepszymi praktykami OWASP i CIS, a zespołowi dev-ops pozwoli skupić się na rozwoju funkcji zamiast gaszenia pożarów.

![Sequence diagram illustrating internal communication and task distribution within a Wazuh cluster, detailing interactions between various client, worker, and master components.](https://pplx-res.cloudinary.com/image/upload/v1748609227/pplx_project_search_images/ab823225ad66e14cf39fa98c38295da24016094c.jpg)

Sequence diagram illustrating internal communication and task distribution within a Wazuh cluster, detailing interactions between various client, worker, and master components.

<div style="text-align: center">⁂</div>

[^1]: https://www.intruder.io/blog/pentesting-tools

[^2]: https://www.jit.io/resources/owasp-zap/how-to-automate-owasp-zap

[^3]: https://www.yeswehack.com/learn-bug-bounty/smart-automation-with-burp-suite

[^4]: https://geekvibesnation.com/the-top-5-penetration-testing-frameworks-and-why-you-should-follow-them/

[^5]: https://www.gartner.com/reviews/market/penetration-testing-tools

[^6]: https://dzone.com/articles/how-to-automate-owasp-zap

[^7]: https://github.com/justmorpheus/burp-automation

[^8]: https://docs.cobalt.io/methodologies/web-methodologies/

[^9]: https://www.reddit.com/r/AskNetsec/comments/13j9h9i/automated_penetration_testing_software/

[^10]: https://www.zaproxy.org/docs/automate/automation-framework/

[^11]: https://www.xplg.com/solution-it-tools-log-analysis/

[^12]: https://dev.to/oliverbennet/automated-log-analysis-and-reporting-with-python-bash-and-powershell-a32

[^13]: https://aws.amazon.com/marketplace/pp/prodview-qa7qfot6dpzq6

[^14]: https://www.exabeam.com/explainers/siem/siem-alerts-understanding-security-information-and-event-alerts/

[^15]: https://logz.io/blog/log-file-parsing-tools/

[^16]: https://uptrace.dev/tools/log-analysis-tools

[^17]: https://www.ibm.com/think/topics/ai-for-log-analysis

[^18]: https://eurotux.com/2020/12/monitoring-with-elk-stack/

[^19]: https://stellarcyber.ai/learn/siem-alerts-types-and-best-practices/

[^20]: https://www.ittsystems.com/best-log-parsing-tools/

[^21]: https://www.schellman.com/blog/cybersecurity/penetration-testing-a-cicd-pipeline

[^22]: https://www.opsera.io/blog/devops-security-automation-best-practices

[^23]: https://docs.aws.amazon.com/wellarchitected/2023-04-10/framework/sec_securely_operate_test_validate_pipeline.html

[^24]: https://www.esystems.fi/en/blog/implementing-automated-security-testing-best-practices

[^25]: https://strobes.co/blog/integrating-penetration-testing-as-a-service-ptaas-with-ci-cd-pipelines-a-practical-guide/

[^26]: https://www.techtarget.com/searchsecurity/tip/5-ways-to-automate-security-testing-in-DevSecOps

[^27]: https://www.xenonstack.com/insights/devsecops-pipeline

[^28]: https://phoenixnap.com/blog/automated-security-testing-best-practices

[^29]: https://portswigger.net/developers/ci-cd-security

[^30]: https://www.testingxperts.com/blog/DevSecOps-Automating-Security-into-the-Testing-Process

[^31]: https://www.techtarget.com/searchsecurity/tip/11-open-source-automated-penetration-testing-tools

[^32]: https://github.com/0xKayala/NucleiScanner

[^33]: https://www.lambdatest.com/blog/penetration-testing-tools/

[^34]: https://www.softwaretestinghelp.com/web-security-scanners/

[^35]: https://github.com/enaqx/awesome-pentest

[^36]: https://pubmed.ncbi.nlm.nih.gov/16943767/

[^37]: https://www.testing101.net/post/top-10-security-testing-tools

[^38]: https://www.getastra.com/blog/security-audit/web-application-vulnerability-scanner/

[^39]: https://www.bluevoyant.com/knowledge-center/penetration-testing-tools-6-free-tools-you-should-know

[^40]: https://osintteam.blog/part-3-advanced-techniques-use-cases-of-nuclei-for-bug-bounty-1fb810800b8c?gi=f5599e2d9aa3

[^41]: https://www.techtarget.com/searchsecurity/tip/Security-log-management-and-logging-best-practices

[^42]: https://www.ccs.neu.edu/home/alina/papers/LogAnalytics.pdf

[^43]: https://github.com/logpai/loglizer

[^44]: https://ebooks.iospress.nl/pdf/doi/10.3233/FAIA220378

[^45]: https://www.xplg.com/what-logs-to-monitor-list/

[^46]: https://www.ossec.net/docs/docs/manual/monitoring/index.html

[^47]: https://github.com/Jaron-S/Security-Log-Analysis-and-Reporting-Automation

[^48]: https://log-anomaly-detector.readthedocs.io/en/latest/

[^49]: https://cheatsheetseries.owasp.org/cheatsheets/Logging_Cheat_Sheet.html

[^50]: https://wazuh.com/resources/use-cases/log-data-analysis/

[^51]: https://signoz.io/blog/open-source-log-management/

[^52]: https://documentation.wazuh.com/current/installation-guide/wazuh-server/step-by-step.html

[^53]: https://security.stackexchange.com/questions/149601/hids-choosing-between-regular-ossec-or-wazuh-fork

[^54]: https://www.aikido.dev/blog/top-continuous-security-monitoring-tools

[^55]: https://uptrace.dev/blog/open-source-log-management

[^56]: https://www.youtube.com/watch?v=wlvXSkXnYz4

[^57]: https://stackshare.io/stackups/ossec-vs-wazuh

[^58]: https://www.bossecurity.com/2024/05/20/optimize-your-defenses-choosing-the-best-real-time-security-monitoring-solutions-for-your-business/

[^59]: https://www.reddit.com/r/linuxadmin/comments/130vvze/a_quick_and_dirty_tool_for_log_analysis_and/

[^60]: https://documentation.wazuh.com/current/installation-guide/index.html

[^61]: https://ossec-docs.readthedocs.io/en/pr_314/docs/manual/monitoring/

[^62]: https://last9.io/blog/logstash-grok-examples/

[^63]: https://serverfault.com/questions/933604/elk-logs-from-application-disappearing-when-grok-rules-are-enabled

[^64]: https://www.academia.edu/8343225/Log_Analysis_using_OSSEC

[^65]: https://stackoverflow.com/questions/53076730/grok-pattern-cannot-parse-logs/53081184

[^66]: https://blog.pentesteracademy.com/premium-lab-hids-log-analysis-ossec-basics-ii-c035655adda9

[^67]: https://stackoverflow.com/questions/48211490/logstash-how-to-use-grok-patterns-coming-from-event-data

[^68]: https://ossec-documentation.readthedocs.io/en/latest/manual/logmonitoring.html

[^69]: https://mydeveloperplanet.com/2021/05/11/automate-zap-with-docker/

[^70]: https://projectdiscovery.io/blog/implementing-nuclei-into-your-github-ci-cd-for-scanning-live-web-applications

[^71]: https://documentation.wazuh.com/current/user-manual/capabilities/active-response/index.html

[^72]: https://about.gitlab.com/blog/2021/12/21/rule-pack-synthesis/

[^73]: https://discuss.elastic.co/t/encrypt-filebeat-to-logstash/242944

[^74]: https://www.linkedin.com/pulse/how-perform-security-testing-using-nuclei-extensive-guide-guha-vncmc

[^75]: https://documentation.wazuh.com/current/user-manual/capabilities/active-response/how-to-configure.html

[^76]: https://cloudcuddler.com/how-to-protect-and-discover-secrets-using-gitleaks/

[^77]: https://serverfault.com/questions/827240/how-to-see-if-filebeat-data-is-being-sent-to-logstash

[^78]: https://www.byteplus.com/en/topic/499339

