"use strict";(self.webpackChunkmy_page=self.webpackChunkmy_page||[]).push([[91693],{9097:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>c,metadata:()=>i,toc:()=>t});var i=a(54159),s=a(74848),o=a(28453);const c={slug:"yubikey-na-fedora",title:"Kompleksowy przewodnik konfiguracji YubiKey na Fedora Linux",authors:["przemyslvw"],tags:["yubikey","fedora","linux","security"],date:"2025-08-06"},r=void 0,l={authorsImageUrls:[void 0]},t=[{value:"Wprowadzenie do YubiKey",id:"wprowadzenie-do-yubikey",level:2},{value:"Ograniczenia pami\u0119ci YubiKey",id:"ograniczenia-pami\u0119ci-yubikey",level:3},{value:"Instalacja podstawowych pakiet\xf3w",id:"instalacja-podstawowych-pakiet\xf3w",level:2},{value:"Dla wszystkich funkcji",id:"dla-wszystkich-funkcji",level:3},{value:"Uruchamianie us\u0142ug",id:"uruchamianie-us\u0142ug",level:3},{value:"Konfiguracja uwierzytelniania systemowego (PAM)",id:"konfiguracja-uwierzytelniania-systemowego-pam",level:2},{value:"Metoda 1: FIDO U2F/FIDO2 (zalecana dla nowych kluczy)",id:"metoda-1-fido-u2ffido2-zalecana-dla-nowych-kluczy",level:3},{value:"Metoda 2: YubiCloud OTP (starsze klucze)",id:"metoda-2-yubicloud-otp-starsze-klucze",level:3},{value:"Metoda 3: Challenge-Response (offline)",id:"metoda-3-challenge-response-offline",level:3},{value:"Konfiguracja konkretnych us\u0142ug",id:"konfiguracja-konkretnych-us\u0142ug",level:2},{value:"Sudo z YubiKey",id:"sudo-z-yubikey",level:3},{value:"Login GDM/graficzny",id:"login-gdmgraficzny",level:3},{value:"Login konsolowy",id:"login-konsolowy",level:3},{value:"SSH z YubiKey",id:"ssh-z-yubikey",level:3},{value:"Konfiguracja OpenPGP/GPG",id:"konfiguracja-openpgpgpg",level:2},{value:"Instalacja i przygotowanie",id:"instalacja-i-przygotowanie",level:3},{value:"Podstawowa konfiguracja GPG",id:"podstawowa-konfiguracja-gpg",level:3},{value:"Zmiana PIN-\xf3w PIV",id:"zmiana-pin-\xf3w-piv",level:3},{value:"Konfiguracja dotykania dla operacji OpenPGP",id:"konfiguracja-dotykania-dla-operacji-openpgp",level:3},{value:"OATH/TOTP (Google Authenticator replacement)",id:"oathtotp-google-authenticator-replacement",level:2},{value:"Instalacja aplikacji",id:"instalacja-aplikacji",level:3},{value:"Zarz\u0105dzanie kontami TOTP",id:"zarz\u0105dzanie-kontami-totp",level:3},{value:"Zaawansowane konfiguracje",id:"zaawansowane-konfiguracje",level:2},{value:"Blokowanie ekranu po wyj\u0119ciu YubiKey",id:"blokowanie-ekranu-po-wyj\u0119ciu-yubikey",level:3},{value:"Konfiguracja r\xf3\u017cnych tryb\xf3w dla r\xf3\u017cnych us\u0142ug",id:"konfiguracja-r\xf3\u017cnych-tryb\xf3w-dla-r\xf3\u017cnych-us\u0142ug",level:3},{value:"Cache i timeout konfiguracja",id:"cache-i-timeout-konfiguracja",level:3},{value:"Rozwi\u0105zywanie problem\xf3w",id:"rozwi\u0105zywanie-problem\xf3w",level:2},{value:"Sprawdzanie statusu YubiKey",id:"sprawdzanie-statusu-yubikey",level:3},{value:"Typowe problemy",id:"typowe-problemy",level:3},{value:"Backup i bezpiecze\u0144stwo",id:"backup-i-bezpiecze\u0144stwo",level:2},{value:"Konfiguracja zapasowego klucza",id:"konfiguracja-zapasowego-klucza",level:3},{value:"Testowanie konfiguracji",id:"testowanie-konfiguracji",level:3},{value:"Podsumowanie",id:"podsumowanie",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"YubiKey to uniwersalne urz\u0105dzenie bezpiecze\u0144stwa, kt\xf3re mo\u017ce znacznie zwi\u0119kszy\u0107 ochron\u0119 systemu Linux. Ten przewodnik przedstawia wszystkie aspekty konfiguracji YubiKey na Fedora, od podstawowej instalacji po zaawansowane scenariusze u\u017cytkowania."}),"\n",(0,s.jsx)(n.h2,{id:"wprowadzenie-do-yubikey",children:"Wprowadzenie do YubiKey"}),"\n",(0,s.jsx)(n.p,{children:"YubiKey to fizyczny token bezpiecze\u0144stwa, kt\xf3ry \u0142\u0105czy w sobie kilka technologii uwierzytelniania:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"FIDO U2F/FIDO2"})," - nowoczesne standardy uwierzytelniania"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OTP (One-Time Password)"})," - jednorazowe has\u0142a"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PIV (Personal Identity Verification)"})," - przechowywanie certyfikat\xf3w i kluczy prywatnych"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OpenPGP"})," - szyfrowanie i podpisy cyfrowe"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OATH"})," - kompatybilno\u015b\u0107 z TOTP/HOTP (Google Authenticator, itd.)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"ograniczenia-pami\u0119ci-yubikey",children:"Ograniczenia pami\u0119ci YubiKey"}),"\n",(0,s.jsxs)(n.p,{children:["Ka\u017cdy modu\u0142 ma swoje limity przechowywania:",(0,s.jsx)(n.sup,{children:(0,s.jsx)(n.a,{href:"#user-content-fn-1-f0b905",id:"user-content-fnref-1-f0b905","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OTP"})," - nielimitowane (jeden sekret na klucz)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"FIDO U2F"})," - nielimitowane (jeden sekret na klucz)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"FIDO2"})," - 25 po\u015bwiadcze\u0144"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OATH"})," - 32 po\u015bwiadczenia"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PIV"})," - 24 certyfikaty X.509 z kluczami prywatnymi"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OpenPGP"})," - 3 klucze (szyfrowanie, podpisywanie, uwierzytelnianie)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"instalacja-podstawowych-pakiet\xf3w",children:"Instalacja podstawowych pakiet\xf3w"}),"\n",(0,s.jsx)(n.h3,{id:"dla-wszystkich-funkcji",children:"Dla wszystkich funkcji"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Podstawowe narz\u0119dzia YubiKey\nsudo dnf install yubikey-manager yubikey-manager-qt\n\n# Dla uwierzytelniania PAM (starsze klucze bez FIDO2)\nsudo dnf install pam_yubico\n\n# Dla uwierzytelniania FIDO U2F/FIDO2\nsudo dnf install pam-u2f pamu2fcfg\n\n# Dla obs\u0142ugi OpenPGP/smartcard\nsudo dnf install pcsc-lite\n\n# Dla SSH z PKCS#11\nsudo dnf install opensc\n\n# GUI do personalizacji (starsze narz\u0119dzie)\nsudo dnf install yubikey-personalization-gui\n"})}),"\n",(0,s.jsx)(n.h3,{id:"uruchamianie-us\u0142ug",children:"Uruchamianie us\u0142ug"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Uruchomienie us\u0142ugi smartcard\nsudo systemctl enable --now pcscd\n"})}),"\n",(0,s.jsx)(n.h2,{id:"konfiguracja-uwierzytelniania-systemowego-pam",children:"Konfiguracja uwierzytelniania systemowego (PAM)"}),"\n",(0,s.jsx)(n.h3,{id:"metoda-1-fido-u2ffido2-zalecana-dla-nowych-kluczy",children:"Metoda 1: FIDO U2F/FIDO2 (zalecana dla nowych kluczy)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Krok 1: Rejestracja klucza"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Utworzenie katalogu\nmkdir -p ~/.config/Yubico\n\n# Rejestracja pierwszego klucza\npamu2fcfg > ~/.config/Yubico/u2f_keys\n\n# Dodanie zapasowego klucza (zalecane!)\npamu2fcfg -n >> ~/.config/Yubico/u2f_keys\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Krok 2: Konfiguracja plik\xf3w PAM"})}),"\n",(0,s.jsxs)(n.p,{children:["Utw\xf3rz pliki konfiguracyjne w ",(0,s.jsx)(n.code,{children:"/etc/pam.d/"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# /etc/pam.d/u2f-required\n#%PAM-1.0\nauth required pam_u2f.so\n\n# /etc/pam.d/u2f-sufficient  \n#%PAM-1.0\nauth sufficient pam_u2f.so\n"})}),"\n",(0,s.jsx)(n.h3,{id:"metoda-2-yubicloud-otp-starsze-klucze",children:"Metoda 2: YubiCloud OTP (starsze klucze)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Krok 1: Rejestracja klucza"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Utworzenie katalogu\nmkdir -p ~/.yubico\n\n# Naci\u015bnij YubiKey, aby uzyska\u0107 OTP - pierwsze 12 znak\xf3w to ID klucza\necho "fedora-user:cccccbcgebif" > ~/.yubico/authorized_keys\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Krok 2: Konfiguracja PAM"})," (wymaga API key od Yubico)",(0,s.jsx)(n.sup,{children:(0,s.jsx)(n.a,{href:"#user-content-fn-2-f0b905",id:"user-content-fnref-2-f0b905","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# /etc/pam.d/yubikey-required\n#%PAM-1.0  \nauth required pam_yubico.so id=[Your API Client ID] key=[Your API Client Key]\n\n# /etc/pam.d/yubikey-sufficient\n#%PAM-1.0\nauth sufficient pam_yubico.so id=[Your API Client ID] key=[Your API Client Key]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"metoda-3-challenge-response-offline",children:"Metoda 3: Challenge-Response (offline)"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Krok 1: Konfiguracja YubiKey"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Aktywacja challenge-response w slocie 2 (wymaga dotyku)\nykman otp chalresp --generate --touch 2\n\n# Rejestracja klucza dla u\u017cytkownika\nykpamcfg -2\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Krok 2: Konfiguracja PAM"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# /etc/pam.d/yubikey-required\n#%PAM-1.0\nauth required pam_yubico.so mode=challenge-response\n\n# /etc/pam.d/yubikey-sufficient  \n#%PAM-1.0\nauth sufficient pam_yubico.so mode=challenge-response\n"})}),"\n",(0,s.jsx)(n.h2,{id:"konfiguracja-konkretnych-us\u0142ug",children:"Konfiguracja konkretnych us\u0142ug"}),"\n",(0,s.jsx)(n.h3,{id:"sudo-z-yubikey",children:"Sudo z YubiKey"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Opcja A: Wymaga has\u0142a + YubiKey (2FA)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Edytuj /etc/pam.d/sudo\nsudo visudo /etc/pam.d/sudo\n\n# Dodaj AFTER linii "auth substack system-auth":\nauth include u2f-required\n\n# lub yubikey-required dla OTP\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Opcja B: Tylko YubiKey (1FA)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Dodaj BEFORE linii "auth substack system-auth":\nauth include u2f-sufficient\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Konfiguracja cache sudo"})," (rozwi\u0105zanie problemu z powtarzaj\u0105cym si\u0119 \u017c\u0105daniem YubiKey):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Edytuj sudoers\nsudo visudo\n\n# Dodaj na ko\u0144cu pliku:\nDefaults timestamp_timeout=15      # Cache na 15 minut\nDefaults timestamp_timeout=-1      # Cache do ko\u0144ca sesji terminala  \nDefaults timestamp_type=global     # Wsp\xf3lny cache dla wszystkich terminali (opcjonalnie)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"login-gdmgraficzny",children:"Login GDM/graficzny"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Metoda authselect (zalecana)"}),(0,s.jsx)(n.sup,{children:(0,s.jsx)(n.a,{href:"#user-content-fn-3-f0b905",id:"user-content-fnref-3-f0b905","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"3"})})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Sprawdzenie aktualnego profilu\nsudo authselect current\n\n# W\u0142\u0105czenie U2F dla profilu sssd\nsudo authselect select sssd with-pam-u2f\n\n# Lub dla profilu local\nsudo authselect select local with-pam-u2f\n\n# Zastosowanie zmian\nsudo authselect apply-changes\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Metoda manualna"})," (edycja ",(0,s.jsx)(n.code,{children:"/etc/pam.d/gdm-password"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Dodaj BEFORE "auth substack password-auth":\nauth include u2f-sufficient\n\n# Lub AFTER dla 2FA:\nauth include u2f-required\n'})}),"\n",(0,s.jsx)(n.h3,{id:"login-konsolowy",children:"Login konsolowy"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Edytuj /etc/pam.d/login\n# Dodaj przed "auth substack system-auth":\nauth include u2f-sufficient\n'})}),"\n",(0,s.jsx)(n.h3,{id:"ssh-z-yubikey",children:"SSH z YubiKey"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Opcja A: FIDO2 SSH keys (nowoczesne)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Generowanie klucza wymagaj\u0105cego obecno\u015bci YubiKey\nssh-keygen -t ed25519-sk\n\n# Generowanie klucza rezydentnego (przeno\u015bnego)\nssh-keygen -t ed25519-sk -O resident -O application=ssh:fedora -O verify-required\n\n# Kopiowanie klucza publicznego na serwer\nssh-copy-id -i ~/.ssh/id_ed25519_sk.pub user@server\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Opcja B: PIV/PKCS#11 (starsze klucze)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Generowanie klucza w module PIV\nykman piv keys generate --algorithm ED25519 --pin-policy ONCE --touch-policy ALWAYS 9a public.pem\n\n# Tworzenie certyfikatu\nykman piv certificates generate --subject "CN=OpenSSH" --hash-algorithm SHA384 9a public.pem\n\n# Eksport klucza publicznego\nssh-keygen -D /usr/lib64/libykcs11.so -e\n\n# Logowanie z PKCS#11\nssh -I /usr/lib64/libykcs11.so user@server\n'})}),"\n",(0,s.jsx)(n.h2,{id:"konfiguracja-openpgpgpg",children:"Konfiguracja OpenPGP/GPG"}),"\n",(0,s.jsx)(n.h3,{id:"instalacja-i-przygotowanie",children:"Instalacja i przygotowanie"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Instalacja wymaganych pakiet\xf3w (je\u015bli nie zainstalowano wcze\u015bniej)\nsudo dnf install pcsc-lite gnupg2\n\n# Uruchomienie us\u0142ugi\nsudo systemctl enable --now pcscd\n\n# Sprawdzenie po\u0142\u0105czenia z kart\u0105\ngpg --card-status\n"})}),"\n",(0,s.jsx)(n.h3,{id:"podstawowa-konfiguracja-gpg",children:"Podstawowa konfiguracja GPG"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Utw\xf3rz plik konfiguracyjny scdaemon\necho "disable-ccid" >> ~/.gnupg/scdaemon.conf\n\n# Restart agenta GPG\ngpg-connect-agent reloadagent /bye\n'})}),"\n",(0,s.jsx)(n.h3,{id:"zmiana-pin-\xf3w-piv",children:"Zmiana PIN-\xf3w PIV"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Zmiana PIN-u u\u017cytkownika (domy\u015blnie: 123456)\nykman piv access change-pin\n\n# Zmiana PUK (domy\u015blnie: 12345678)  \nykman piv access change-puk\n\n# Zmiana klucza zarz\u0105dzania\nykman piv access change-management-key --generate --protect\n"})}),"\n",(0,s.jsx)(n.h3,{id:"konfiguracja-dotykania-dla-operacji-openpgp",children:"Konfiguracja dotykania dla operacji OpenPGP"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Wymaganie dotyku dla podpisywania\nykman openpgp keys set-touch sig on\n\n# Wymaganie dotyku dla szyfrowania  \nykman openpgp keys set-touch dec on\n\n# Wymaganie dotyku dla uwierzytelniania\nykman openpgp keys set-touch aut on\n"})}),"\n",(0,s.jsx)(n.h2,{id:"oathtotp-google-authenticator-replacement",children:"OATH/TOTP (Google Authenticator replacement)"}),"\n",(0,s.jsx)(n.h3,{id:"instalacja-aplikacji",children:"Instalacja aplikacji"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Aplikacja desktopowa\nsudo dnf install yubioath-desktop\n\n# Lub u\u017cyj Yubico Authenticator z oficjalnej strony\n"})}),"\n",(0,s.jsx)(n.h3,{id:"zarz\u0105dzanie-kontami-totp",children:"Zarz\u0105dzanie kontami TOTP"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Ustawienie has\u0142a dla aplikacji OATH\nykman oath access change\n\n# Zapami\u0119tanie has\u0142a (\u017ceby nie pyta\u0142o za ka\u017cdym razem)\nykman oath access remember\n\n# Dodanie konta TOTP  \nykman oath accounts add google <TOTP_SECRET>\n\n# Generowanie kodu\nykman oath accounts code google\n\n# Lista wszystkich kont\nykman oath accounts list\n\n# Usuwanie konta\nykman oath accounts delete google\n"})}),"\n",(0,s.jsx)(n.h2,{id:"zaawansowane-konfiguracje",children:"Zaawansowane konfiguracje"}),"\n",(0,s.jsx)(n.h3,{id:"blokowanie-ekranu-po-wyj\u0119ciu-yubikey",children:"Blokowanie ekranu po wyj\u0119ciu YubiKey"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Utw\xf3rz regu\u0142\u0119 udev w /etc/udev/rules.d/85-yubikey-lock.rules\nACTION=="remove", ENV{ID_BUS}=="usb", ENV{ID_MODEL_ID}=="0407", ENV{ID_VENDOR_ID}=="1050", RUN+="/usr/bin/loginctl lock-sessions"\n\n# Prze\u0142aduj regu\u0142y\nsudo udevadm control --reload\n'})}),"\n",(0,s.jsx)(n.h3,{id:"konfiguracja-r\xf3\u017cnych-tryb\xf3w-dla-r\xf3\u017cnych-us\u0142ug",children:"Konfiguracja r\xf3\u017cnych tryb\xf3w dla r\xf3\u017cnych us\u0142ug"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Przyk\u0142ad: Password + YubiKey dla sudo, tylko YubiKey dla terminala"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# /etc/pam.d/sudo - 2FA\nauth substack system-auth\nauth include u2f-required\n\n# /etc/pam.d/login - 1FA  \nauth include u2f-sufficient\nauth substack system-auth\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cache-i-timeout-konfiguracja",children:"Cache i timeout konfiguracja"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# W /etc/sudoers (visudo):\nDefaults timestamp_timeout=900     # 15 minut cache\nDefaults passwd_timeout=5          # 5 sekund na wprowadzenie has\u0142a\nDefaults passwd_tries=3            # 3 pr\xf3by wprowadzenia has\u0142a\n"})}),"\n",(0,s.jsx)(n.h2,{id:"rozwi\u0105zywanie-problem\xf3w",children:"Rozwi\u0105zywanie problem\xf3w"}),"\n",(0,s.jsx)(n.h3,{id:"sprawdzanie-statusu-yubikey",children:"Sprawdzanie statusu YubiKey"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Podstawowe informacje\nykman info\n\n# Status wszystkich aplikacji  \nykman --list\n\n# Status karty OpenPGP\ngpg --card-status\n\n# Status FIDO2\nykman fido info\n\n# Logi PAM\njournalctl -f | grep pam\n"})}),"\n",(0,s.jsx)(n.h3,{id:"typowe-problemy",children:"Typowe problemy"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Problem: YubiKey nie jest rozpoznawany"}),(0,s.jsx)(n.sup,{children:(0,s.jsx)(n.a,{href:"#user-content-fn-4-f0b905",id:"user-content-fnref-4-f0b905","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"4"})})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Sprawd\u017a czy zainstalowany pcsc-lite\nsudo dnf install pcsc-lite\nsudo systemctl restart pcscd\n\n# Sprawd\u017a uprawnienia\nls -la /dev/bus/usb/\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Problem: GPG nie widzi YubiKey"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Sprawd\u017a scdaemon\necho "disable-ccid" >> ~/.gnupg/scdaemon.conf\ngpg-connect-agent "scd serialno" "scd learn" /bye\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Problem: Sudo przy ka\u017cdym u\u017cyciu wymaga YubiKey"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Ustaw timestamp_timeout w sudoers\necho "Defaults timestamp_timeout=900" | sudo tee -a /etc/sudoers\n'})}),"\n",(0,s.jsx)(n.h2,{id:"backup-i-bezpiecze\u0144stwo",children:"Backup i bezpiecze\u0144stwo"}),"\n",(0,s.jsx)(n.h3,{id:"konfiguracja-zapasowego-klucza",children:"Konfiguracja zapasowego klucza"}),"\n",(0,s.jsxs)(n.p,{children:["Zawsze konfiguruj drugi YubiKey jako backup:",(0,s.jsx)(n.sup,{children:(0,s.jsx)(n.a,{href:"#user-content-fn-1-f0b905",id:"user-content-fnref-1-f0b905-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})}),(0,s.jsx)(n.sup,{children:(0,s.jsx)(n.a,{href:"#user-content-fn-2-f0b905",id:"user-content-fnref-2-f0b905-2","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"2"})})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Dla U2F - dodaj drugi klucz\npamu2fcfg -n >> ~/.config/Yubico/u2f_keys\n\n# Dla OTP - dodaj ID drugiego klucza\necho "fedora-user:cccccbcgebif:dddddddddddd" > ~/.yubico/authorized_keys\n\n# Dla SSH - wygeneruj klucze na obu urz\u0105dzeniach\nssh-keygen -t ed25519-sk    # Na pierwszym kluczu\nssh-keygen -t ed25519-sk    # Na zapasowym kluczu\n'})}),"\n",(0,s.jsx)(n.h3,{id:"testowanie-konfiguracji",children:"Testowanie konfiguracji"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"ZAWSZE testuj w drugim terminalu przed zamkni\u0119ciem bie\u017c\u0105cego!"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Test sudo w nowym terminalu\nsudo echo "test"\n\n# Test logowania w nowej sesji SSH\nssh localhost\n\n# Test logowania GDM - zablokuj i odblokuj ekran\n'})}),"\n",(0,s.jsx)(n.h2,{id:"podsumowanie",children:"Podsumowanie"}),"\n",(0,s.jsx)(n.p,{children:"YubiKey oferuje wielopoziomow\u0105 ochron\u0119 systemu Fedora Linux. Najwa\u017cniejsze zalecenia:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Zawsze konfiguruj zapasowy klucz"})," - hardware token mo\u017ce si\u0119 zepsu\u0107 lub zgubi\u0107"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Testuj ka\u017cd\u0105 zmian\u0119"})," w osobnej sesji przed zamkni\u0119ciem obecnej"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"U\u017cywaj FIDO2"})," dla nowych kluczy (bezpieczniejsze i wygodniejsze)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Konfiguruj cache sudo"})," - unikniesz frustracji z ci\u0105g\u0142ym dotykaniem klucza"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Regularnie tw\xf3rz kopie zapasowe"})," konfiguracji PAM i plik\xf3w autoryzacji"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Dzi\u0119ki odpowiedniej konfiguracji YubiKey mo\u017ce znacznie zwi\u0119kszy\u0107 bezpiecze\u0144stwo bez nadmiernego wp\u0142ywu na wygod\u0119 u\u017cytkowania. Kluczem jest znalezienie r\xf3wnowagi mi\u0119dzy bezpiecze\u0144stwem a praktyczno\u015bci\u0105 dla konkretnego \u015brodowiska i przypadku u\u017cycia."}),"\n",(0,s.jsx)("div",{style:{textAlign:"center"},children:"\u2042"}),"\n","\n",(0,s.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,s.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{id:"user-content-fn-1-f0b905",children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://docs.fedoraproject.org/en-US/quick-docs/using-yubikeys/",children:"https://docs.fedoraproject.org/en-US/quick-docs/using-yubikeys/"})," ",(0,s.jsx)(n.a,{href:"#user-content-fnref-1-f0b905","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})," ",(0,s.jsxs)(n.a,{href:"#user-content-fnref-1-f0b905-2","data-footnote-backref":"","aria-label":"Back to reference 1-2",className:"data-footnote-backref",children:["\u21a9",(0,s.jsx)(n.sup,{children:"2"})]})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{id:"user-content-fn-2-f0b905",children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://discussion.fedoraproject.org/t/how-to-configure-yubico-key-for-system-login/154317",children:"https://discussion.fedoraproject.org/t/how-to-configure-yubico-key-for-system-login/154317"})," ",(0,s.jsx)(n.a,{href:"#user-content-fnref-2-f0b905","data-footnote-backref":"","aria-label":"Back to reference 2",className:"data-footnote-backref",children:"\u21a9"})," ",(0,s.jsxs)(n.a,{href:"#user-content-fnref-2-f0b905-2","data-footnote-backref":"","aria-label":"Back to reference 2-2",className:"data-footnote-backref",children:["\u21a9",(0,s.jsx)(n.sup,{children:"2"})]})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{id:"user-content-fn-3-f0b905",children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://devblog.jpcaparas.com/use-your-yubikey-as-a-system-level-authentication-pam-module-on-fedora-40-457ae7375254",children:"https://devblog.jpcaparas.com/use-your-yubikey-as-a-system-level-authentication-pam-module-on-fedora-40-457ae7375254"})," ",(0,s.jsx)(n.a,{href:"#user-content-fnref-3-f0b905","data-footnote-backref":"","aria-label":"Back to reference 3",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{id:"user-content-fn-4-f0b905",children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://solenberg.dev/yubikey-setup/",children:"https://solenberg.dev/yubikey-setup/"})," ",(0,s.jsx)(n.a,{href:"#user-content-fnref-4-f0b905","data-footnote-backref":"","aria-label":"Back to reference 4",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>c,x:()=>r});var i=a(96540);const s={},o=i.createContext(s);function c(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(o.Provider,{value:n},e.children)}},54159:e=>{e.exports=JSON.parse('{"permalink":"/blog/yubikey-na-fedora","editUrl":"https://github.com/przemyslvw/my-page/edit/master/blog/2025-08-06-yubikey-na-fedora/index.md","source":"@site/blog/2025-08-06-yubikey-na-fedora/index.md","title":"Kompleksowy przewodnik konfiguracji YubiKey na Fedora Linux","description":"YubiKey to uniwersalne urz\u0105dzenie bezpiecze\u0144stwa, kt\xf3re mo\u017ce znacznie zwi\u0119kszy\u0107 ochron\u0119 systemu Linux. Ten przewodnik przedstawia wszystkie aspekty konfiguracji YubiKey na Fedora, od podstawowej instalacji po zaawansowane scenariusze u\u017cytkowania.","date":"2025-08-06T00:00:00.000Z","tags":[{"inline":false,"label":"YubiKey","permalink":"/blog/tags/yubikey","description":"Uwierzytelnianie dwusk\u0142adnikowe za pomoc\u0105 klucza sprz\u0119towego YubiKey."},{"inline":false,"label":"Fedora","permalink":"/blog/tags/blog/tags/fedora"},{"inline":false,"label":"Linux","permalink":"/blog/tags/linux","description":"Komendy, skrypty i konfiguracje dla system\xf3w Linux."},{"inline":false,"label":"Security","permalink":"/blog/tags/security","description":"Ochrona danych, system\xf3w i sieci komputerowych."}],"readingTime":6.99,"hasTruncateMarker":false,"authors":[{"name":"Przemys\u0142aw Majdak","title":"Full-Stack Developer, Automation Engineer & Web Security Specialist","url":"https://www.majdak.online","bio":"In\u017cynier aplikacji internetowych, specjalista ds. automatyzacji test\xf3w i bezpiecze\u0144stwa IT.","socials":{"github":"https://github.com/przemyslvw","instagram":"https://www.instagram.com/przemas.ts","x":"https://x.com/przemyslvw","garmin":"https://connect.garmin.com/modern/profile/396bbbd1-edbd-4fd4-a780-132723eef739"},"imageURL":"https://avatars.githubusercontent.com/u/31745530?v=4","key":"przemyslvw","page":null}],"frontMatter":{"slug":"yubikey-na-fedora","title":"Kompleksowy przewodnik konfiguracji YubiKey na Fedora Linux","authors":["przemyslvw"],"tags":["yubikey","fedora","linux","security"],"date":"2025-08-06"},"unlisted":false,"nextItem":{"title":"Google ujawnia ogromn\u0105 luk\u0119 bezpiecze\u0144stwa dzi\u0119ki AI \u2013 czy Twoje dane s\u0105 bezpieczne?","permalink":"/blog/news-2025-08-05"}}')}}]);