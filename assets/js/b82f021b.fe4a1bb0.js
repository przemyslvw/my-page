"use strict";(self.webpackChunkmy_page=self.webpackChunkmy_page||[]).push([[95242],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var a=i(96540);const r={},s=a.createContext(r);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(s.Provider,{value:n},e.children)}},49653:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"kurs-owasp/testowanie-podatnosci/a03-injection-konfiguracja","title":"\u2699\ufe0f 3.3.3 \u2013 Weryfikacja konfiguracji aplikacji i serwera","description":"\ud83c\udfaf Cel sekcji","source":"@site/docs/kurs-owasp/03-testowanie-podatnosci/a03-injection-konfiguracja.md","sourceDirName":"kurs-owasp/03-testowanie-podatnosci","slug":"/kurs-owasp/testowanie-podatnosci/a03-injection-konfiguracja","permalink":"/docs/kurs-owasp/testowanie-podatnosci/a03-injection-konfiguracja","draft":false,"unlisted":false,"editUrl":"https://github.com/przemyslvw/my-page/edit/master/docs/kurs-owasp/03-testowanie-podatnosci/a03-injection-konfiguracja.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"id":"a03-injection-konfiguracja","title":"\u2699\ufe0f 3.3.3 \u2013 Weryfikacja konfiguracji aplikacji i serwera","sidebar_position":13},"sidebar":"tutorialSidebar","previous":{"title":"\ud83e\uddea 3.3.2 \u2013 Metody testowania podatno\u015bci","permalink":"/docs/kurs-owasp/testowanie-podatnosci/a03-injection-testowanie"},"next":{"title":"\ud83e\uddf0 3.3.4 \u2013 Narz\u0119dzia do testowania","permalink":"/docs/kurs-owasp/testowanie-podatnosci/a03-injection-narzedzia"}}');var r=i(74848),s=i(28453);const o={id:"a03-injection-konfiguracja",title:"\u2699\ufe0f 3.3.3 \u2013 Weryfikacja konfiguracji aplikacji i serwera",sidebar_position:13},c=void 0,d={},l=[{value:"\ud83c\udfaf Cel sekcji",id:"-cel-sekcji",level:2},{value:"\ud83d\udd0d Obszary do weryfikacji",id:"-obszary-do-weryfikacji",level:2},{value:"\ud83d\udd38 1. Obs\u0142uga danych wej\u015bciowych",id:"-1-obs\u0142uga-danych-wej\u015bciowych",level:3},{value:"\ud83d\udd38 2. Spos\xf3b wykonywania zapyta\u0144",id:"-2-spos\xf3b-wykonywania-zapyta\u0144",level:3},{value:"\ud83d\udd38 3. Uprawnienia bazy danych",id:"-3-uprawnienia-bazy-danych",level:3},{value:"\ud83d\udd38 4. Logowanie i obs\u0142uga b\u0142\u0119d\xf3w",id:"-4-logowanie-i-obs\u0142uga-b\u0142\u0119d\xf3w",level:3},{value:"\ud83d\udd38 5. Middleware i serwer",id:"-5-middleware-i-serwer",level:3},{value:"\u2705 Przyk\u0142ady zabezpiecze\u0144 w ASP.NET Core (Kestrel / IIS)",id:"-przyk\u0142ady-zabezpiecze\u0144-w-aspnet-core-kestrel--iis",level:4},{value:"\u2705 Ochrona przed Remote Code Execution (RCE)",id:"-ochrona-przed-remote-code-execution-rce",level:4},{value:"\u274c Przyk\u0142ad niebezpieczny",id:"-przyk\u0142ad-niebezpieczny",level:4},{value:"\u2705 Przyk\u0142ad bezpieczny (whitelistowane komendy)",id:"-przyk\u0142ad-bezpieczny-whitelistowane-komendy",level:4},{value:"\ud83e\udde0 Dodatkowe \u015brodki bezpiecze\u0144stwa",id:"-dodatkowe-\u015brodki-bezpiecze\u0144stwa",level:2},{value:"\ud83d\udcbb Przyk\u0142ady dla aplikacji .NET (C# / ASP.NET Core)",id:"-przyk\u0142ady-dla-aplikacji-net-c--aspnet-core",level:2},{value:"\u2705 Poprawne podej\u015bcie: parametryzowane zapytania",id:"-poprawne-podej\u015bcie-parametryzowane-zapytania",level:3},{value:"\u274c Z\u0142e podej\u015bcie: dynamiczne zapytania SQL",id:"-z\u0142e-podej\u015bcie-dynamiczne-zapytania-sql",level:3},{value:"\u2705 Bezpieczne u\u017cycie Entity Framework (LINQ)",id:"-bezpieczne-u\u017cycie-entity-framework-linq",level:3},{value:"\u274c Niebezpieczne u\u017cycie FromSqlRaw",id:"-niebezpieczne-u\u017cycie-fromsqlraw",level:3},{value:"\u2699\ufe0f Przyk\u0142ad konfiguracji ASP.NET Core",id:"\ufe0f-przyk\u0142ad-konfiguracji-aspnet-core",level:2},{value:"\ud83d\udccb Przyk\u0142ad poprawnej konfiguracji \u2013 Node.js + PostgreSQL",id:"-przyk\u0142ad-poprawnej-konfiguracji--nodejs--postgresql",level:2},{value:"\u274c Przyk\u0142ad z\u0142ej praktyki",id:"-przyk\u0142ad-z\u0142ej-praktyki",level:2},{value:"\ud83e\udde0 Wskaz\xf3wki",id:"-wskaz\xf3wki",level:2}];function t(e){const n={code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"-cel-sekcji",children:"\ud83c\udfaf Cel sekcji"}),"\n",(0,r.jsxs)(n.p,{children:["Zidentyfikowa\u0107 s\u0142abe punkty w konfiguracji aplikacji i serwera, kt\xf3re umo\u017cliwiaj\u0105 lub zwi\u0119kszaj\u0105 ryzyko wyst\u0105pienia podatno\u015bci typu ",(0,r.jsx)(n.strong,{children:"Injection"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-obszary-do-weryfikacji",children:"\ud83d\udd0d Obszary do weryfikacji"}),"\n",(0,r.jsx)(n.h3,{id:"-1-obs\u0142uga-danych-wej\u015bciowych",children:"\ud83d\udd38 1. Obs\u0142uga danych wej\u015bciowych"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Czy dane wej\u015bciowe s\u0105 walidowane po stronie serwera?"}),"\n",(0,r.jsx)(n.li,{children:"Czy stosowane s\u0105 bia\u0142e listy dozwolonych warto\u015bci?"}),"\n",(0,r.jsxs)(n.li,{children:["Czy aplikacja odrzuca nieoczekiwane znaki (",(0,r.jsx)(n.code,{children:"'"}),", ",(0,r.jsx)(n.code,{children:'"'}),", ",(0,r.jsx)(n.code,{children:";"}),", ",(0,r.jsx)(n.code,{children:"--"}),", ",(0,r.jsx)(n.code,{children:"|"}),", ",(0,r.jsx)(n.code,{children:"$"}),", ",(0,r.jsx)(n.code,{children:"<"}),", ",(0,r.jsx)(n.code,{children:">"})," itd.)?"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-2-spos\xf3b-wykonywania-zapyta\u0144",children:"\ud83d\udd38 2. Spos\xf3b wykonywania zapyta\u0144"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Czy w backendzie stosowane s\u0105 ",(0,r.jsx)(n.strong,{children:"prepared statements"})," (np. ",(0,r.jsx)(n.code,{children:"?"})," lub named parameters)?"]}),"\n",(0,r.jsxs)(n.li,{children:["Czy unika si\u0119 sk\u0142adania zapyta\u0144 SQL/LDAP/XML za pomoc\u0105 ",(0,r.jsx)(n.code,{children:"+"}),", ",(0,r.jsx)(n.code,{children:"concat"}),", ",(0,r.jsx)(n.code,{children:"eval"}),", ",(0,r.jsx)(n.code,{children:"exec"}),", ",(0,r.jsx)(n.code,{children:"system()"}),"?"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-3-uprawnienia-bazy-danych",children:"\ud83d\udd38 3. Uprawnienia bazy danych"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Czy aplikacja korzysta z konta DB z minimalnymi uprawnieniami (",(0,r.jsx)(n.code,{children:"SELECT"})," tylko je\u015bli nie ma potrzeby ",(0,r.jsx)(n.code,{children:"INSERT"}),"/",(0,r.jsx)(n.code,{children:"UPDATE"}),")?"]}),"\n",(0,r.jsxs)(n.li,{children:["Czy konto nie ma dost\u0119pu do polece\u0144 ",(0,r.jsx)(n.code,{children:"DROP"}),", ",(0,r.jsx)(n.code,{children:"DELETE"}),", ",(0,r.jsx)(n.code,{children:"ALTER"}),"?"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-4-logowanie-i-obs\u0142uga-b\u0142\u0119d\xf3w",children:"\ud83d\udd38 4. Logowanie i obs\u0142uga b\u0142\u0119d\xf3w"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Czy aplikacja NIE wy\u015bwietla b\u0142\u0119d\xf3w SQL/LDAP/command w odpowiedzi HTTP?"}),"\n",(0,r.jsx)(n.li,{children:"Czy b\u0142\u0119dy s\u0105 logowane bez ujawniania stosu lub szczeg\xf3\u0142\xf3w u\u017cytkownikowi?"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-5-middleware-i-serwer",children:"\ud83d\udd38 5. Middleware i serwer"}),"\n",(0,r.jsx)(n.p,{children:"Bezpieczna konfiguracja \u015brodowiska uruchomieniowego i middleware aplikacji .NET ma kluczowe znaczenie dla ochrony przed atakami typu injection."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"-przyk\u0142ady-zabezpiecze\u0144-w-aspnet-core-kestrel--iis",children:"\u2705 Przyk\u0142ady zabezpiecze\u0144 w ASP.NET Core (Kestrel / IIS)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"builder.WebHost.ConfigureKestrel(serverOptions =>\n{\n    serverOptions.Limits.MaxRequestBodySize = 1048576; // 1 MB\n    serverOptions.Limits.KeepAliveTimeout = TimeSpan.FromSeconds(10);\n    serverOptions.Limits.RequestHeadersTimeout = TimeSpan.FromSeconds(10);\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 Ograniczenie rozmiaru \u017c\u0105dania i czasu na nag\u0142\xf3wki chroni przed atakami typu ",(0,r.jsx)(n.strong,{children:"Slowloris"})," i pr\xf3b\u0105 przes\u0142ania z\u0142o\u015bliwego payloadu o du\u017cej obj\u0119to\u015bci."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"-ochrona-przed-remote-code-execution-rce",children:"\u2705 Ochrona przed Remote Code Execution (RCE)"}),"\n",(0,r.jsx)(n.p,{children:"Unikaj niekontrolowanego u\u017cycia:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"Process.Start(input); // \u274c podatne\n"})}),"\n",(0,r.jsx)(n.p,{children:"Zamiast tego:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Nigdy nie wykonuj komend bazuj\u0105cych na danych u\u017cytkownika."}),"\n",(0,r.jsxs)(n.li,{children:["Weryfikuj dopuszczalne warto\u015bci (np. tylko ",(0,r.jsx)(n.code,{children:"ping"}),", ",(0,r.jsx)(n.code,{children:"nslookup"})," z whitelisty)."]}),"\n",(0,r.jsxs)(n.li,{children:["U\u017cywaj ",(0,r.jsx)(n.code,{children:"switch"}),"/",(0,r.jsx)(n.code,{children:"enum"})," i tylko z g\xf3ry okre\u015blonych warto\u015bci."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"-przyk\u0142ad-niebezpieczny",children:"\u274c Przyk\u0142ad niebezpieczny"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'string cmd = Request.Query["cmd"];\nProcess.Start("cmd.exe", $"/C {cmd}");\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u27a1\ufe0f ",(0,r.jsx)(n.code,{children:"http://app.local/?cmd=del C:\\Users"})," mo\u017ce skutkowa\u0107 RCE!"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h4,{id:"-przyk\u0142ad-bezpieczny-whitelistowane-komendy",children:"\u2705 Przyk\u0142ad bezpieczny (whitelistowane komendy)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'var allowedCommands = new Dictionary<string, string>\n{\n    { "status", "systemctl status app" },\n    { "uptime", "uptime" }\n};\n\nif (allowedCommands.ContainsKey(input))\n{\n    Process.Start("/bin/bash", $"-c "{allowedCommands[input]}"");\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-dodatkowe-\u015brodki-bezpiecze\u0144stwa",children:"\ud83e\udde0 Dodatkowe \u015brodki bezpiecze\u0144stwa"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["U\u017cywaj ",(0,r.jsx)(n.code,{children:"UseAuthorization()"})," i ",(0,r.jsx)(n.code,{children:"UseAuthentication()"})," we w\u0142a\u015bciwej kolejno\u015bci."]}),"\n",(0,r.jsx)(n.li,{children:"Filtruj wej\u015bcie nawet je\u015bli middleware uprzednio je przetworzy\u0142 (defense in depth)."}),"\n",(0,r.jsxs)(n.li,{children:["Upewnij si\u0119, \u017ce ",(0,r.jsx)(n.code,{children:"app.UseDeveloperExceptionPage()"})," NIE jest w\u0142\u0105czony w \u015brodowisku produkcyjnym."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-przyk\u0142ady-dla-aplikacji-net-c--aspnet-core",children:"\ud83d\udcbb Przyk\u0142ady dla aplikacji .NET (C# / ASP.NET Core)"}),"\n",(0,r.jsx)(n.h3,{id:"-poprawne-podej\u015bcie-parametryzowane-zapytania",children:"\u2705 Poprawne podej\u015bcie: parametryzowane zapytania"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using (var command = new SqlCommand("SELECT * FROM Users WHERE Username = @username", connection))\n{\n    command.Parameters.AddWithValue("@username", username);\n    var reader = command.ExecuteReader();\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-z\u0142e-podej\u015bcie-dynamiczne-zapytania-sql",children:"\u274c Z\u0142e podej\u015bcie: dynamiczne zapytania SQL"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'var query = "SELECT * FROM Users WHERE Username = \'" + username + "\'";\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u27a1\ufe0f Wstrzykni\u0119cie ",(0,r.jsx)(n.code,{children:"admin' --"})," pozwoli zalogowa\u0107 si\u0119 bez has\u0142a."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-bezpieczne-u\u017cycie-entity-framework-linq",children:"\u2705 Bezpieczne u\u017cycie Entity Framework (LINQ)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"var user = dbContext.Users.FirstOrDefault(u => u.Username == inputUsername);\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u2705 LINQ automatycznie chroni przed injection."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"-niebezpieczne-u\u017cycie-fromsqlraw",children:"\u274c Niebezpieczne u\u017cycie FromSqlRaw"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"var sql = $\"SELECT * FROM Users WHERE Username = '{inputUsername}'\";\nvar users = dbContext.Users.FromSqlRaw(sql).ToList();\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u27a1\ufe0f Zawsze u\u017cywaj ",(0,r.jsx)(n.code,{children:"FromSqlInterpolated"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'var users = dbContext.Users\n    .FromSqlInterpolated($"SELECT * FROM Users WHERE Username = {inputUsername}")\n    .ToList();\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\ufe0f-przyk\u0142ad-konfiguracji-aspnet-core",children:"\u2699\ufe0f Przyk\u0142ad konfiguracji ASP.NET Core"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'app.UseExceptionHandler("/Error"); // Ukrywanie stack trace\'\xf3w\napp.UseHsts(); // Wymuszanie HTTPS\nservices.AddControllersWithViews()\n        .AddDataAnnotationsLocalization(); // Walidacja wej\u015bcia\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-przyk\u0142ad-poprawnej-konfiguracji--nodejs--postgresql",children:"\ud83d\udccb Przyk\u0142ad poprawnej konfiguracji \u2013 Node.js + PostgreSQL"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'const result = await db.query("SELECT * FROM users WHERE id = $1", [req.params.id]);\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u2705 U\u017cycie parametryzacji zamiast ",(0,r.jsx)(n.code,{children:"string interpolation"}),"."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-przyk\u0142ad-z\u0142ej-praktyki",children:"\u274c Przyk\u0142ad z\u0142ej praktyki"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'const result = await db.query("SELECT * FROM users WHERE id = " + req.params.id);\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u2757 Ryzyko SQL Injection, je\u015bli ",(0,r.jsx)(n.code,{children:"req.params.id"})," pochodzi od u\u017cytkownika."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-wskaz\xf3wki",children:"\ud83e\udde0 Wskaz\xf3wki"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Przejrzyj kod aplikacji pod k\u0105tem dynamicznych zapyta\u0144."}),"\n",(0,r.jsx)(n.li,{children:"Sprawd\u017a konfiguracj\u0119 bazy i serwera dla ka\u017cdego \u015brodowiska (dev/test/prod)."}),"\n",(0,r.jsx)(n.li,{children:"Automatyzuj skanowanie kodu i konfiguracji przy pomocy linters / SAST."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:["W kolejnym kroku: ",(0,r.jsx)(n.strong,{children:"3.3.4 \u2013 Narz\u0119dzia do testowania Injection"})]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(t,{...e})}):t(e)}}}]);